import{x as d,V as u,a1 as h,W as v,q as p,y as l,I as m,P as g,ay as b,z as y,aP as k,aQ as w,v as A,ad as F,aR as M,aS as _,aT as S}from"./Cm-v4IFc.js";class T{anchor;#t=new Map;#s=new Map;#e=new Map;#i=new Set;#n=!0;constructor(e,t=!0){this.anchor=e,this.#n=t}#a=()=>{var e=d;if(this.#t.has(e)){var t=this.#t.get(e),s=this.#s.get(t);if(s)u(s),this.#i.delete(t);else{var i=this.#e.get(t);i&&(this.#s.set(t,i.effect),this.#e.delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),s=i.effect)}for(const[n,a]of this.#t){if(this.#t.delete(n),n===e)break;const c=this.#e.get(a);c&&(h(c.effect),this.#e.delete(a))}for(const[n,a]of this.#s){if(n===t||this.#i.has(n))continue;const c=()=>{if(Array.from(this.#t.values()).includes(n)){var f=document.createDocumentFragment();b(a,f),f.append(p()),this.#e.set(n,{effect:a,fragment:f})}else h(a);this.#i.delete(n),this.#s.delete(n)};this.#n||!s?(this.#i.add(n),v(a,c,!1)):c()}}};#r=e=>{this.#t.delete(e);const t=Array.from(this.#t.values());for(const[s,i]of this.#e)t.includes(s)||(h(i.effect),this.#e.delete(s))};ensure(e,t){var s=d,i=y();if(t&&!this.#s.has(e)&&!this.#e.has(e))if(i){var n=document.createDocumentFragment(),a=p();n.append(a),this.#e.set(e,{effect:l(()=>t(a)),fragment:n})}else this.#s.set(e,l(()=>t(this.anchor)));if(this.#t.set(s,e),i){for(const[c,o]of this.#s)c===e?s.skipped_effects.delete(o):s.skipped_effects.add(o);for(const[c,o]of this.#e)c===e?s.skipped_effects.delete(o.effect):s.skipped_effects.add(o.effect);s.oncommit(this.#a),s.ondiscard(this.#r)}else m&&(this.anchor=g),this.#a()}}function P(r){const e=r();e&&!(typeof e=="string")&&w()}function x(r){return r.toString=()=>(k(),""),r}function R(r,e,...t){var s=new T(r);A(()=>{const i=e()??null;i==null&&M(),s.ensure(i,i&&(n=>i(n,...t)))},F)}function B(r,e){const t=(s,...i)=>{var n=S;_(r);try{return e(s,...i)}finally{_(n)}};return x(t),t}export{T as B,R as s,P as v,B as w};
